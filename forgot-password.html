<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Forgot Password - FunaGig</title>
    <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
    <header class="navbar">
        <div class="brand">
            <div class="logo"></div> FunaGig
        </div>
        <nav class="nav-actions">
            <a class="btn ghost" href="index.html">Home</a>
            <a class="btn" href="signup.html">Sign Up</a>
        </nav>
    </header>

    <main class="auth-wrap">
        <form class="card card-lg" id="forgot-password-form">
            <h1 class="h1" style="font-size:32px; text-align:center;">Forgot Password</h1>
            <p class="subtle mb-10" style="text-align:center;">Enter your email address and we'll send you a password reset link</p>
            
            <div class="field">
                <label class="label">Email *</label>
                <input class="input" id="email" name="email" type="email" placeholder="Enter your email" required />
                <div class="error-message" id="emailError"></div>
            </div>
            
            <button type="submit" class="btn" style="width: 100%;">Send Reset Link</button>
            
            <div class="section mt-20" style="text-align:center;">
                <p class="subtle">Remember your password? 
                    <a href="auth.html" style="color: var(--primary);">Log in</a>
                </p>
            </div>

            <!-- Development Mode: Display Token -->
            <div id="dev-token-container" style="display: none; margin-top: 20px; padding: 16px; background: #f0f0f0; border-radius: 8px; border: 1px solid #ddd;">
                <p style="font-size: 12px; color: #666; margin-bottom: 8px;"><strong>Development Mode:</strong> Since email is not configured, here's your reset token:</p>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <input type="text" id="reset-token" readonly style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 12px;" />
                    <button type="button" onclick="copyToken()" class="btn secondary" style="padding: 8px 16px; font-size: 12px;">Copy</button>
                </div>
                <p style="font-size: 12px; color: #666; margin-top: 8px;">
                    <a href="reset-password.html" style="color: var(--primary);">Click here to reset your password</a>
                </p>
            </div>
        </form>
    </main>

    <script src="js/app.js"></script>
    <script>
        document.getElementById('forgot-password-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            clearErrors();
            
            const email = document.getElementById('email').value.trim();
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            
            let isValid = true;
            
            if (!email) {
                showError('emailError', 'Email is required');
                isValid = false;
            } else if (!isValidEmail(email)) {
                showError('emailError', 'Please enter a valid email address');
                isValid = false;
            }
            
            if (isValid) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Sending...';
                
                apiFetch('/auth/forgot-password', {
                    method: 'POST',
                    body: JSON.stringify({ email: email })
                })
                .then(response => {
                    if (response.success) {
                        // Show success message
                        Toast.success(response.message || 'Password reset link sent!');
                        
                        // In development mode, show token
                        if (response.dev_mode && response.token) {
                            document.getElementById('reset-token').value = response.token;
                            document.getElementById('dev-token-container').style.display = 'block';
                        } else {
                            // In production, show message and redirect
                            setTimeout(() => {
                                window.location.href = 'auth.html';
                            }, 2000);
                        }
                    } else {
                        showError('emailError', response.error || 'Failed to send reset link');
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                    }
                })
                .catch(error => {
                    console.error('Forgot password error:', error);
                    showError('emailError', 'Error: Could not connect to server');
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                });
            }
        });
        
        function copyToken() {
            const tokenInput = document.getElementById('reset-token');
            tokenInput.select();
            tokenInput.setSelectionRange(0, 99999); // For mobile devices
            document.execCommand('copy');
            Toast.success('Token copied to clipboard!');
        }
        
        function clearErrors() {
            const errorElements = document.querySelectorAll('.error-message');
            errorElements.forEach(element => {
                element.textContent = '';
                element.style.display = 'none';
            });
        }
        
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            errorElement.style.color = 'var(--danger)';
            errorElement.style.fontSize = '12px';
            errorElement.style.marginTop = '4px';
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
    </script>
</body>
</html>

